{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/uiFormDefinition.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "1.0.0",
  "parameters": {
    "basics": [],
    "steps": [
      {
        "name": "settings",
        "label": "Azure-side identity",
        "elements": [
          {
            "name": "resourceGroupName",
            "type": "Microsoft.Common.TextBox",
            "label": "Resource group name",
            "defaultValue": "xcloud-demo-rg",
            "constraints": {
              "required": true,
              "regex": "^[-\\w\\._\\(\\)]+$",
              "validationMessage": "Use letters, numbers, hyphen, underscore, dot, or parentheses."
            }
          },
          {
            "name": "resourceGroupLocation",
            "type": "Microsoft.Common.DropDown",
            "label": "Resource group location",
            "defaultValue": "westus",
            "constraints": { "required": true },
            "options": {
              "allowedValues": [
                { "label": "West US", "value": "westus" },
                { "label": "West US 2", "value": "westus2" },
                { "label": "East US", "value": "eastus" },
                { "label": "East US 2", "value": "eastus2" },
                { "label": "Central US", "value": "centralus" }
              ]
            }
          },
          {
            "name": "uamiName",
            "type": "Microsoft.Common.TextBox",
            "label": "User Assigned Managed Identity name",
            "defaultValue": "xcloud-demo-uami",
            "constraints": { "required": true }
          }
        ]
      },
      {
        "name": "awsTrust",
        "label": "AWS trust (federated credential)",
        "elements": [
          {
            "name": "issuer",
            "type": "Microsoft.Common.TextBox",
            "label": "OIDC issuer URL",
            "defaultValue": "https://sts.amazonaws.com",
            "constraints": { "required": true }
          },
          {
            "name": "subject",
            "type": "Microsoft.Common.TextBox",
            "label": "Subject (AWS IAM role ARN)",
            "constraints": { "required": true }
          },
          {
            "name": "audience",
            "type": "Microsoft.Common.TextBox",
            "label": "Audience",
            "defaultValue": "api://AzureADTokenExchange",
            "constraints": { "required": true }
          }
        ]
      }
    ],
    "outputs": {
      "resourceGroupName": "[steps('settings').resourceGroupName]",
      "resourceGroupLocation": "[steps('settings').resourceGroupLocation]",
      "uamiName": "[steps('settings').uamiName]",
      "issuer": "[steps('awsTrust').issuer]",
      "subject": "[steps('awsTrust').subject]",
      "audiences": "[createArray(steps('awsTrust').audience)]",
      "deploymentLocation": "[steps('settings').resourceGroupLocation]"
    }
  }
}
