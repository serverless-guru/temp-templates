{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/uiFormDefinition.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "1.0.0",
  "parameters": {
    "basics": [],
    "steps": [
      {
        "name": "settings",
        "label": "Azure-side identity",
        "elements": [
          {
            "name": "resourceGroupName",
            "type": "Microsoft.Common.TextBox",
            "label": "Resource group name",
            "defaultValue": "xcloud-demo-rg",
            "constraints": {
              "required": true,
              "regex": "^[-\\w\\._\\(\\)]+$",
              "validationMessage": "Use letters, numbers, hyphen, underscore, dot, or parentheses."
            }
          },
          {
            "name": "uamiName",
            "type": "Microsoft.Common.TextBox",
            "label": "User Assigned Managed Identity name",
            "defaultValue": "xcloud-demo-uami",
            "constraints": {
              "required": true,
              "regex": "^[a-zA-Z0-9-]{3,128}$",
              "validationMessage": "3-128 chars: letters, numbers, hyphen."
            }
          }
        ]
      },
      {
        "name": "awsTrust",
        "label": "AWS trust",
        "elements": [
          {
            "name": "subject",
            "type": "Microsoft.Common.TextBox",
            "label": "AWS IAM role ARN (subject)",
            "toolTip": "Example: arn:aws:iam::123456789012:role/MyRole",
            "constraints": {
              "required": true,
              "regex": "^arn:aws:iam::[0-9]{12}:role/.+",
              "validationMessage": "Expected: arn:aws:iam::123456789012:role/RoleName"
            }
          }
        ]
      }
    ],
    "outputs": {
      "resourceGroupName": "[steps('settings').resourceGroupName]",
      "uamiName": "[steps('settings').uamiName]",
      "subject": "[steps('awsTrust').subject]"
    }
  }
}
